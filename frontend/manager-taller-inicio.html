<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inicio - Goversa</title>
  <link rel="icon" type="image/png" href="assets/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/guard.js"></script>
  <!-- FontAwesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Material Symbols (Iconos) -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
    rel="stylesheet" />

  <link rel="stylesheet" href="manager.css">
  <style>
    /* --- VARIABLES & BASE --- */
    /* Redundant variables removed */

    /* --- SCROLLBAR --- */
    /* Redundant scrollbar styles removed */

    /* --- SIDEBAR --- */
    #sidebar {
      background: rgba(17, 19, 24, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-right: 1px solid var(--border-subtle);
    }

    /* --- FORM CONTENEDOR --- */
    .form-main-title {
      font-size: 28px;
      font-weight: 800;
      margin: 0 0 10px 0;
      background: linear-gradient(to right, #fff, #ccc);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
    }

    .page-subtitle {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 30px;
    }

    /* --- DASHBOARD CARDS --- */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .stat-card:hover {
      border-color: var(--brand-orange);
      background: rgba(255, 101, 43, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
    }

    .stat-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-label {
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-secondary);
      letter-spacing: 0.5px;
    }

    .stat-icon {
      padding: 8px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 800;
      color: white;
      letter-spacing: -1px;
    }

    /* --- SECTION CONTAINERS --- */
    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 25px;
    }

    @media (max-width: 1024px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    .dashboard-panel {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .panel-title {
      font-size: 16px;
      font-weight: 700;
      color: white;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* --- TABLE STYLES (Recycled from manager-taller-compras) --- */
    .dashboard-table {
      width: 100%;
      border-collapse: collapse;
    }

    .dashboard-table th {
      text-align: left;
      padding: 12px 16px;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      border-bottom: 1px solid var(--border-subtle);
    }

    .dashboard-table td {
      padding: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      color: var(--text-primary);
      font-size: 14px;
    }

    .dashboard-table tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }

    /* --- BADGES --- */
    .status-badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      display: inline-block;
    }

    /* --- INPUTS reused --- */
    .form-input {
      width: 100%;
      padding: 10px 16px;
      border-radius: 10px;
      background-color: var(--input-bg);
      border: 1px solid var(--border-subtle);
      color: var(--text-primary);
      font-family: "Montserrat", sans-serif;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--brand-orange);
      background-color: rgba(255, 101, 43, 0.05);
    }

    .btn {
      background: linear-gradient(135deg, var(--brand-orange) 0%, var(--brand-orange-dark) 100%);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.5px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      border-radius: 10px;
      padding: 10px 20px;
      box-shadow: 0 4px 14px rgba(255, 101, 43, 0.4);
      font-size: 14px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 101, 43, 0.6);
    }
  </style>
</head>

<body>

  <div class="flex h-screen w-full">

    <!-- SIDEBAR -->
    <aside id="sidebar"
      class="flex h-full w-64 flex-col bg-[#111318] p-4 shrink-0 transition-all duration-300 ease-in-out border-r border-[var(--surface-border)]">
      <div class="flex h-full flex-col justify-between">
        <div class="flex flex-col gap-4">
          <!-- User Profile / Logo Area -->
          <div class="flex items-center gap-3 p-2 mb-4">
            <div class="logo-badge"
              style="padding: 8px; border-radius: 12px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
              <img src="https://i.imgur.com/Mjw4or5.png" alt="Logo" class="logo-img" style="height: 24px; width: auto;">
            </div>
            <div class="flex flex-col sidebar-text">
              <h1 class="text-white text-base font-medium leading-normal" style="font-size: 15px;">
                Goversa</h1>
              <p class="text-[#9da6b9] text-sm font-normal leading-normal" style="font-size: 12px;">
                Gestión</p>
            </div>
            <button id="toggle-sidebar" class="ml-auto text-gray-400 hover:text-white">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>

          <!-- Navigation Links -->
          <nav class="flex flex-col gap-2">
            <a class="flex items-center gap-3 px-3 py-2 bg-[var(--brand-orange)] text-white rounded-lg transition-colors"
              href="manager-taller-inicio.html">
              <span class="icon-container"><i class="fas fa-home"></i></span>
              <p class="text-sm font-medium leading-normal sidebar-text">Inicio</p>
            </a>

            <!-- Taller Dropdown -->
            <div class="nav-group">
              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                onclick="toggleSubmenu('taller-submenu')">
                <span class="icon-container"><i class="fas fa-wrench"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text flex-1">Taller</p>
                <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="taller-arrow"></i>
              </a>
              <div id="taller-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                <a href="manager-taller-citas.html" class="text-gray-500 hover:text-white text-sm py-1 block">Citas</a>
                <a href="manager-taller-ordenes-lista.html"
                  class="text-gray-500 hover:text-white text-sm py-1 block">Órdenes</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Editar
                  órdenes</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Presupuestos</a>
                <a href="manager-taller-vehiculos.html"
                  class="text-gray-500 hover:text-white text-sm py-1 block">Vehículos</a>
                <a href="manager-taller-chat.html" class="text-gray-500 hover:text-white text-sm py-1 block">Chat
                  Clientes</a>
              </div>
            </div>

            <!-- Tienda Dropdown -->
            <div class="nav-group">
              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                onclick="toggleSubmenu('tienda-submenu')">
                <span class="icon-container"><i class="fas fa-shopping-cart"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text flex-1">Tienda</p>
                <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="tienda-arrow"></i>
              </a>
              <div id="tienda-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                <a href="manager-taller-compras.html" class="text-gray-500 hover:text-white text-sm py-1 block">Nueva
                  Compra</a>
                <a href="manager-taller-compras-historial.html"
                  class="text-gray-500 hover:text-white text-sm py-1 block">Historial Compras</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Ventas</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Productos</a>
              </div>
            </div>

            <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
              href="#">
              <span class="icon-container"><i class="fas fa-cash-register"></i></span>
              <p class="text-sm font-medium leading-normal sidebar-text">Caja</p>
            </a>

            <!-- Cuentas Dropdown -->
            <div class="nav-group">
              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                onclick="toggleSubmenu('cuentas-submenu')">
                <span class="icon-container"><i class="fas fa-file-invoice-dollar"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text flex-1">Cuentas</p>
                <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="cuentas-arrow"></i>
              </a>
              <div id="cuentas-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                <a href="manager-taller-facturas.html"
                  class="text-gray-400 hover:text-white text-sm py-1 block">Facturas</a>
                <a href="manager-taller-facturas-pendientes.html"
                  class="text-gray-400 hover:text-white text-sm py-1 block">Pendientes Facturar</a>
                <a href="manager-taller-config-facturas.html"
                  class="text-gray-400 hover:text-white text-sm py-1 block">Configuración</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Gastos</a>
              </div>
            </div>

            <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
              href="manager-taller-inventario.html">
              <span class="icon-container"><i class="fas fa-boxes"></i></span>
              <p class="text-sm font-medium leading-normal sidebar-text">Inventario</p>
            </a>

            <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
              href="manager-taller-trabajadores.html">
              <span class="icon-container"><i class="fas fa-users-cog"></i></span>
              <p class="text-sm font-medium leading-normal sidebar-text">Trabajadores</p>
            </a>

            <!-- Contactos -->
            <div class="nav-group">
              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                onclick="toggleSubmenu('contactos-submenu')">
                <span class="icon-container"><i class="fas fa-address-book"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text flex-1">Contactos</p>
                <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="contactos-arrow"></i>
              </a>
              <div id="contactos-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                <a href="manager-taller-clientes.html"
                  class="text-gray-500 hover:text-white text-sm py-1 block">Clientes</a>
                <a href="manager-taller-proveedores.html"
                  class="text-gray-500 hover:text-white text-sm py-1 block">Proveedores</a>
              </div>
            </div>
          </nav>
        </div>

        <!-- Bottom Actions -->
        <div class="flex flex-col gap-1 border-t border-[var(--surface-border)] pt-4">
          <div class="flex items-center gap-3 px-3 py-2 mb-2">
            <div
              class="w-8 h-8 rounded-full bg-[var(--brand-orange)] flex items-center justify-center text-white font-bold text-xs">
              IM
            </div>
            <div class="flex flex-col sidebar-text overflow-hidden">
              <span class="text-white text-sm font-medium truncate">Iván Moreno</span>
              <span class="text-gray-500 text-xs truncate">admin</span>
            </div>
          </div>
          <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
            href="#" data-logout>
            <span class="icon-container"><i class="fas fa-sign-out-alt"></i></span>
            <p class="text-sm font-medium leading-normal sidebar-text">Salir</p>
          </a>
        </div>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden relative">

      <!-- Mobile Header -->
      <header
        class="md:hidden flex items-center justify-between p-4 bg-[#111318] border-b border-[var(--border-subtle)] z-30">
        <div class="logo-badge p-2">
          <img src="https://i.imgur.com/Mjw4or5.png" alt="Logo" class="h-6 w-auto">
        </div>
        <button id="mobile-menu-btn" class="text-white p-2">
          <i class="fas fa-bars fa-lg"></i>
        </button>
      </header>

      <main class="flex-1 overflow-y-auto p-6 relative z-10 w-full">

        <div class="manager-panel w-full max-w-7xl mx-auto">

          <!-- HEADER ZONE -->
          <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div>
              <h2 class="form-main-title">Resumen General</h2>
              <p class="page-subtitle">Bienvenido, aquí tienes un resumen de la actividad de hoy</p>
            </div>

            <div class="flex items-center gap-4">
              <div class="relative hidden md:block">
                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"
                  style="font-size: 20px;">search</span>
                <input type="text" placeholder="Buscar..." class="form-input pl-10" style="width: 200px;">
              </div>

              <a href="manager-taller-ordenes.html" class="btn">
                <span class="material-symbols-outlined mr-2" style="font-size: 20px;">add_circle</span>
                Nueva Orden
              </a>
            </div>
          </div>

          <!-- STATS GRID -->
          <div class="dashboard-grid">
            <div class="stat-card" onclick="window.location='manager-taller-ordenes-lista.html'">
              <div class="stat-card-header">
                <span class="stat-label">Órdenes Activas</span>
                <div class="stat-icon bg-amber-500/10 text-amber-500">
                  <span class="material-symbols-outlined">build_circle</span>
                </div>
              </div>
              <span class="stat-value" id="stat-ordenes-activas">-</span>
            </div>

            <div class="stat-card">
              <div class="stat-card-header">
                <span class="stat-label">Ingresos del Día</span>
                <div class="stat-icon bg-green-500/10 text-green-500">
                  <span class="material-symbols-outlined">payments</span>
                </div>
              </div>
              <span class="stat-value" id="stat-ingresos-dia">-</span>
            </div>

            <div class="stat-card" onclick="window.location='manager-taller-ordenes-lista.html?estado=COMPLETADA'">
              <div class="stat-card-header">
                <span class="stat-label">Por Entregar</span>
                <div class="stat-icon bg-blue-500/10 text-blue-500">
                  <span class="material-symbols-outlined">local_shipping</span>
                </div>
              </div>
              <span class="stat-value" id="stat-listas-entregar">-</span>
            </div>

            <div class="stat-card" onclick="window.location='manager-taller-inventario.html?stock_bajo=1'">
              <div class="stat-card-header">
                <span class="stat-label">Stock Bajo</span>
                <div class="stat-icon bg-red-500/10 text-red-500">
                  <span class="material-symbols-outlined">warning</span>
                </div>
              </div>
              <span class="stat-value" id="stat-stock-bajo">-</span>
            </div>
          </div>

          <!-- CONTENT GRID -->
          <div class="content-grid">
            <!-- Recent Orders Table -->
            <div class="dashboard-panel">
              <div class="panel-header">
                <h3 class="panel-title">
                  <span class="material-symbols-outlined text-[var(--brand-orange)]">assignment</span>
                  Últimas Órdenes
                </h3>
                <a href="manager-taller-ordenes-lista.html"
                  class="text-xs text-gray-500 hover:text-white transition-colors">Ver todas</a>
              </div>

              <div class="overflow-x-auto">
                <table class="dashboard-table">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Cliente</th>
                      <th>Vehículo</th>
                      <th>Estado</th>
                      <th class="text-right">Acción</th>
                    </tr>
                  </thead>
                  <tbody id="ultimas-ordenes-tbody">
                    <tr>
                      <td colspan="5" class="text-center text-gray-500 py-4">Cargando...</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Weekly Chart -->
            <div class="dashboard-panel">
              <div class="panel-header">
                <h3 class="panel-title">
                  <span class="material-symbols-outlined text-[var(--brand-orange)]">bar_chart</span>
                  Rendimiento
                </h3>
              </div>

              <div class="flex-1 flex items-end justify-between gap-2 h-64 pb-2">
                <!-- Bars (Static mockup for now, can be dynamic later) -->
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[#282e39] hover:bg-[var(--brand-orange)] transition-all h-[40%]"
                    title="Lunes"></div>
                  <span class="text-xs text-gray-500">L</span>
                </div>
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[#282e39] hover:bg-[var(--brand-orange)] transition-all h-[60%]"
                    title="Martes"></div>
                  <span class="text-xs text-gray-500">M</span>
                </div>
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[#282e39] hover:bg-[var(--brand-orange)] transition-all h-[50%]"
                    title="Miércoles"></div>
                  <span class="text-xs text-gray-500">X</span>
                </div>
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[var(--brand-orange)] shadow-[0_0_15px_rgba(255,95,0,0.4)] h-[80%]"
                    title="Jueves"></div>
                  <span class="text-xs font-bold text-white">J</span>
                </div>
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[#282e39] hover:bg-[var(--brand-orange)] transition-all h-[75%]"
                    title="Viernes"></div>
                  <span class="text-xs text-gray-500">V</span>
                </div>
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[#282e39] hover:bg-[var(--brand-orange)] transition-all h-[30%]"
                    title="Sábado"></div>
                  <span class="text-xs text-gray-500">S</span>
                </div>
                <div class="flex flex-col items-center gap-2 w-full h-full justify-end">
                  <div
                    class="w-full max-w-[20px] rounded-t bg-[#282e39] hover:bg-[var(--brand-orange)] transition-all h-[20%]"
                    title="Domingo"></div>
                  <span class="text-xs text-gray-500">D</span>
                </div>
              </div>
            </div>
          </div>

        </div>

      </main>
    </div>

  </div>

  <script>
    window.toggleSubmenu = function (id) {
      const submenu = document.getElementById(id);
      const arrowId = id.replace('submenu', 'arrow');
      const arrow = document.getElementById(arrowId);

      if (submenu.classList.contains('hidden')) {
        submenu.classList.remove('hidden');
        submenu.classList.add('flex');
        if (arrow) arrow.style.transform = 'rotate(180deg)';
      } else {
        submenu.classList.add('hidden');
        submenu.classList.remove('flex');
        if (arrow) arrow.style.transform = 'rotate(0deg)';
      }
    }

    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggle-sidebar');
    const sidebarTexts = document.querySelectorAll('.sidebar-text');
    let isCollapsed = false;

    toggleBtn.addEventListener('click', () => {
      isCollapsed = !isCollapsed;
      if (isCollapsed) {
        sidebar.classList.remove('w-64');
        sidebar.classList.add('w-20');
        sidebarTexts.forEach(el => el.classList.add('hidden'));
        toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
        document.querySelectorAll('[id$="-submenu"]').forEach(el => {
          el.classList.add('hidden');
          el.classList.remove('flex');
        });
      } else {
        sidebar.classList.add('w-64');
        sidebar.classList.remove('w-20');
        sidebarTexts.forEach(el => el.classList.remove('hidden'));
        toggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      }
    });

    document.getElementById('mobile-menu-btn').addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      sidebar.classList.toggle('absolute');
      sidebar.classList.toggle('z-50');
      sidebar.classList.toggle('h-full');
    });
  </script>

  <script type="module">
    import { getOrdenes } from './services/ordenes-service.js';
    import { requireAuth, clearSession, redirectToLogin } from './auth.js';

    // Logout logic
    document.querySelector('[data-logout]')?.addEventListener('click', (e) => {
      e.preventDefault();
      clearSession();
      redirectToLogin();
    });

    const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';

    // Cargar estadísticas del dashboard
    async function cargarEstadisticas() {
      try {
        const user = await requireAuth();
        if (!user) return;


        // Cargar órdenes para obtener conteos
        const ordenes = await getOrdenes({});

        // Calcular estadísticas
        const ordenesActivas = ordenes.filter(o =>
          o.estado_codigo !== 'ENTREGADA' && o.estado_codigo !== 'CANCELADA'
        ).length;

        const listasEntregar = ordenes.filter(o =>
          o.estado_codigo === 'COMPLETADA'
        ).length;

        // Actualizar UI
        document.getElementById('stat-ordenes-activas').textContent = ordenesActivas;
        document.getElementById('stat-listas-entregar').textContent = listasEntregar;

        // Calcular ingresos del día
        const hoy = new Date();
        hoy.setHours(0, 0, 0, 0);
        const ingresosHoy = ordenes
          .filter(o => new Date(o.fecha_ingreso) >= hoy)
          .reduce((sum, o) => sum + parseFloat(o.total_neto || 0), 0);
        document.getElementById('stat-ingresos-dia').textContent = `€${ingresosHoy.toFixed(2)}`;

        // Stock bajo (placeholder por ahora)
        document.getElementById('stat-stock-bajo').textContent = '0';

        // Renderizar últimas órdenes
        renderUltimasOrdenes(ordenes.slice(0, 5));

      } catch (error) {
        console.error('Error cargando estadísticas:', error);
        document.getElementById('stat-ordenes-activas').textContent = '-';
        document.getElementById('stat-ingresos-dia').textContent = '-';
        document.getElementById('stat-listas-entregar').textContent = '-';
        document.getElementById('stat-stock-bajo').textContent = '-';
      }
    }

    function renderUltimasOrdenes(ordenes) {
      const tbody = document.getElementById('ultimas-ordenes-tbody');

      if (ordenes.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500 py-4">No hay órdenes</td></tr>';
        return;
      }

      tbody.innerHTML = ordenes.map(orden => {
        // Determinar colores del estado (usando clases personalizadas o tailwind inline si no están en CSS)
        let badgeClass = 'bg-yellow-500/10 text-yellow-500';
        if (orden.estado_codigo === 'EN_PROGRESO') badgeClass = 'bg-blue-500/10 text-blue-500';
        else if (orden.estado_codigo === 'COMPLETADA') badgeClass = 'bg-green-500/10 text-green-500';
        else if (orden.estado_codigo === 'ENTREGADA') badgeClass = 'bg-purple-500/10 text-purple-500';

        return `
              <tr>
                <td class="whitespace-nowrap font-medium text-white">#${orden.id}</td>
                <td class="whitespace-nowrap">${orden.cliente_nombre || '-'}</td>
                <td class="whitespace-nowrap">${orden.vehiculo_marca || ''} ${orden.vehiculo_modelo || ''}</td>
                <td class="whitespace-nowrap">
                  <span class="status-badge ${badgeClass}">${orden.estado_nombre || 'Abierta'}</span>
                </td>
                <td class="whitespace-nowrap text-right">
                  <a class="text-[var(--brand-orange)] hover:text-white font-semibold text-sm transition-colors" href="manager-taller-ordenes.html?id=${orden.id}">Ver</a>
                </td>
              </tr>
            `;
      }).join('');
    }

    // Cargar al inicio
    cargarEstadisticas();
  </script>
</body>

</html>