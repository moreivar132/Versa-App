<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Trabajadores - Goversa</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/guard.js"></script>
    <!-- FontAwesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Material Symbols (Iconos) -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="manager.css">
  <style>
    /* Estilos Generales (Reutilizados para consistencia) */
    /* Redundant variables removed */

    /* Estructura del formulario */



    .form-main-title {
      font-size: 28px;
      font-weight: 800;
      margin: 0 0 10px 0;
    }

    .form-section-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--brand-orange);
      margin-top: 30px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .form-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .form-group label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      background-color: var(--input-bg);
      border: 1px solid #444;
      color: var(--text-primary);
      font-family: "Montserrat", Arial, sans-serif;
      font-size: 15px;
      box-sizing: border-box;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }

    .form-select {
      background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20width%3D%2220%22%20height%3D%2220%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cpath%20d%3D%22M5%208l5%205%205-5z%22%20fill%3D%22%23A0A0A0%22/%3E%3C/svg%3E');
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 20px;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--brand-orange);
      box-shadow: 0 0 0 3px rgba(255, 95, 0, 0.2);
    }

    .btn {
      background-color: var(--brand-orange);
      color: var(--text-primary);
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-family: "Montserrat", Arial, sans-serif;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.2s;
      border-radius: 8px;
      padding: 12px 20px;
    }

    .btn:hover {
      background-color: #e05300;
    }

    /* --- ESTILOS PARA MODAL DE ÉXITO --- */
    .success-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 2000;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s;
    }

    .success-modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .success-modal-content {
      background-color: var(--surface-bg);
      padding: 40px;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      width: 90%;
      max-width: 450px;
      text-align: center;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }

    .success-modal-overlay.show .success-modal-content {
      transform: scale(1);
    }

    .success-modal-content h3 {
      font-size: 24px;
      margin-top: 20px;
      margin-bottom: 10px;
      color: var(--success-color);
    }

    .success-modal-content p {
      color: var(--text-secondary);
      margin-bottom: 30px;
    }

    .success-modal-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto;
      border: 4px solid var(--success-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .success-modal-icon svg {
      width: 40px;
      height: 40px;
      color: var(--success-color);
    }

    @media (max-width: 768px) {
      .form-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="flex h-screen w-full">
    <!-- SideNavBar -->
    <aside id="sidebar"
      class="flex h-full w-64 flex-col bg-[#111318] p-4 shrink-0 transition-all duration-300 ease-in-out border-r border-[var(--surface-border)]">
      <div class="flex h-full flex-col justify-between">
        <div class="flex flex-col gap-4">
          <!-- User Profile / Logo Area -->
          <div class="flex items-center gap-3 p-2 mb-4">
            <div class="logo-badge"
              style="padding: 8px; border-radius: 12px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
              <img src="https://i.imgur.com/Mjw4or5.png" alt="Logo" class="logo-img" style="height: 24px; width: auto;">
            </div>
            <div class="flex flex-col sidebar-text">
              <h1 class="text-white text-base font-medium leading-normal" style="font-size: 15px;">Goversa</h1>
              <p class="text-[#9da6b9] text-sm font-normal leading-normal" style="font-size: 12px;">Gestión</p>
            </div>
            <button id="toggle-sidebar" class="ml-auto text-gray-400 hover:text-white">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>

          <!-- Navigation Links -->
          <nav class="flex flex-col gap-2">
            <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
              href="index.html">
              <span class="icon-container"><i class="fas fa-home"></i></span>
              <p class="text-sm font-medium leading-normal sidebar-text">Inicio</p>
            </a>

            <!-- Taller Dropdown -->
            <div class="nav-group">
              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                onclick="toggleSubmenu('taller-submenu')">
                <span class="icon-container"><i class="fas fa-wrench"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text flex-1">Taller</p>
                <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="taller-arrow"></i>
              </a>
              <div id="taller-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                <a href="manager-taller-citas.html" class="text-gray-400 hover:text-white text-sm py-1 block">Citas</a>
                <a href="manager-taller-ordenes.html"
                  class="text-gray-400 hover:text-white text-sm py-1 block">Órdenes</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Editar órdenes</a>
                <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Presupuestos</a>
                <a href="manager-taller-vehiculos.html"
                  class="text-gray-500 hover:text-white text-sm py-1 block">Vehículos</a>
                <a href="manager-taller-chat.html" class="text-gray-500 hover:text-white text-sm py-1 block">Chat
                  Clientes</a>
              </div>

              <!-- Tienda Dropdown -->
              <div class="nav-group">
                <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                  onclick="toggleSubmenu('tienda-submenu')">
                  <span class="icon-container"><i class="fas fa-shopping-cart"></i></span>
                  <p class="text-sm font-medium leading-normal sidebar-text flex-1">Tienda</p>
                  <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="tienda-arrow"></i>
                </a>
                <div id="tienda-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                  <a href="manager-taller-compras.html" class="text-gray-500 hover:text-white text-sm py-1 block">Nueva
                    Compra</a>
                  <a href="manager-taller-compras-historial.html"
                    class="text-gray-500 hover:text-white text-sm py-1 block">Historial Compras</a>
                  <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Ventas</a>
                  <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Productos</a>
                </div>
              </div>

              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
                href="#">
                <span class="icon-container"><i class="fas fa-cash-register"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text">Caja</p>
              </a>

              <!-- Cuentas Dropdown -->
              <div class="nav-group">
                <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                  onclick="toggleSubmenu('cuentas-submenu')">
                  <span class="icon-container"><i class="fas fa-file-invoice-dollar"></i></span>
                  <p class="text-sm font-medium leading-normal sidebar-text flex-1">Cuentas</p>
                  <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="cuentas-arrow"></i>
                </a>
                <div id="cuentas-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                  <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Facturas</a>
                  <a href="#" class="text-gray-500 hover:text-white text-sm py-1 block">Gastos</a>
                </div>
              </div>

              <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
                href="manager-taller-inventario.html">
                <span class="icon-container"><i class="fas fa-boxes"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text">Inventario</p>
              </a>

              <a class="flex items-center gap-3 px-3 py-2 bg-[var(--brand-orange)] text-white rounded-lg transition-colors"
                href="manager-taller-trabajadores.html">
                <span class="icon-container"><i class="fas fa-users-cog"></i></span>
                <p class="text-sm font-medium leading-normal sidebar-text">Trabajadores</p>
              </a>

              <!-- Contactos -->
              <div class="nav-group">
                <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors cursor-pointer"
                  onclick="toggleSubmenu('contactos-submenu')">
                  <span class="icon-container"><i class="fas fa-address-book"></i></span>
                  <p class="text-sm font-medium leading-normal sidebar-text flex-1">Contactos</p>
                  <i class="fas fa-chevron-down text-xs sidebar-text transition-transform" id="contactos-arrow"></i>
                </a>
                <div id="contactos-submenu" class="hidden flex-col pl-9 gap-1 mt-1">
                  <a href="manager-taller-clientes.html"
                    class="text-gray-500 hover:text-white text-sm py-1 block">Clientes</a>
                  <a href="manager-taller-proveedores.html"
                    class="text-gray-400 hover:text-white text-sm py-1 block">Proveedores</a>
                </div>
              </div>
          </nav>
        </div>

        <!-- Bottom Actions -->
        <div class="flex flex-col gap-1 border-t border-[var(--brand-orange)] pt-4">
          <div class="flex items-center gap-3 px-3 py-2 mb-2">
            <div
              class="w-8 h-8 rounded-full bg-[var(--brand-orange)] flex items-center justify-center text-white font-bold text-xs">
              IM
            </div>
            <div class="flex flex-col sidebar-text overflow-hidden">
              <span class="text-white text-sm font-medium truncate">Iván Moreno</span>
              <span class="text-gray-500 text-xs truncate">admin</span>
            </div>
          </div>
                    <a class="flex items-center gap-3 px-3 py-2 text-gray-400 hover:text-white hover:bg-[#282e39] rounded-lg transition-colors"
                        href="#" data-logout>
            <span class="icon-container"><i class="fas fa-sign-out-alt"></i></span>
            <p class="text-sm font-medium leading-normal sidebar-text">Salir</p>
          </a>
        </div>
      </div>
    </aside>

    <!-- Main Content Wrapper -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden relative">
      <!-- Top Mobile Header -->
      <header
        class="md:hidden flex items-center justify-between p-4 bg-[#111318] border-b border-[var(--surface-border)]">
        <div class="logo-badge p-2">
          <img src="https://i.imgur.com/Mjw4or5.png" alt="Logo" class="h-6 w-auto">
        </div>
        <button id="mobile-menu-btn" class="text-white">
          <i class="fas fa-bars"></i>
        </button>
      </header>

      <main class="flex-1 overflow-y-auto p-6 relative z-10">
        <form id="worker-form" class="manager-panel">
          <h2 class="form-main-title">Registro de Trabajador</h2>

          <div class="form-section">
            <div class="form-group">
              <label for="nombre">Nombre *</label>
              <input type="text" id="nombre" name="nombre" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="tipo_documento">Tipo Documento</label>
              <select id="tipo_documento" name="tipo_documento" class="form-select">
                <option value="DNI">DNI</option>
                <option value="NIE">NIE</option>
                <option value="Pasaporte">Pasaporte</option>
              </select>
            </div>
            <div class="form-group">
              <label for="nif">NIF *</label>
              <input type="text" id="nif" name="nif" class="form-input" required>
            </div>
            <div class="form-group">
              <label for="domicilio">Domicilio</label>
              <input type="text" id="domicilio" name="domicilio" class="form-input">
            </div>
            <div class="form-group">
              <label for="tarea">Tarea</label>
              <select id="tarea" name="tarea" class="form-select">
                <option value="Mecanico">Mecánico</option>
                <option value="Vendedor">Vendedor</option>
                <option value="Cajero">Cajero</option>
                <option value="Contador">Contador</option>
                <option value="Encargado">Encargado</option>
                <option value="Mantenimiento">Mantenimiento</option>
                <option value="Administrador general">Administrador general</option>
                <option value="RRHH">RRHH</option>
                <option value="Staff">Staff</option>
                <option value="Otras">Otras</option>
              </select>
            </div>
            <div class="form-group">
              <label for="comision">Comisión %</label>
              <input type="number" step="0.01" id="comision" name="comision" class="form-input"
                placeholder="Ej: 0.05 para 5%">
            </div>
          </div>

          <h3 class="form-section-title">Contacto</h3>
          <div class="form-section">
            <div class="form-group">
              <label for="telefono">Teléfono</label>
              <input type="tel" id="telefono" name="telefono" class="form-input">
            </div>
            <div class="form-group">
              <label for="telefono_alternativo">Teléfono Alternativo</label>
              <input type="tel" id="telefono_alternativo" name="telefono_alternativo" class="form-input">
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" class="form-input">
            </div>
          </div>

          <button type="submit" class="btn" style="width: 100%; padding: 15px; font-size: 16px; margin-top: 20px;">
            Confirmar Registro
          </button>
        </form>
      </main>
    </div>
  </div>

  <!-- MODAL DE ÉXITO -->
  <div id="success-modal" class="success-modal-overlay">
    <div class="success-modal-content">
      <div class="success-modal-icon">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
          <path
            d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022z" />
        </svg>
      </div>
      <h3>¡Éxito!</h3>
      <p>El trabajador ha sido registrado correctamente.</p>
      <button id="close-success-modal" class="btn">Cerrar</button>
    </div>
  </div>

  <script>
    // --- SIDEBAR LOGIC ---
    window.toggleSubmenu = function (id) {
      const submenu = document.getElementById(id);
      const arrow = document.getElementById(id.replace('submenu', 'arrow'));

      if (submenu.classList.contains('hidden')) {
        submenu.classList.remove('hidden');
        submenu.classList.add('flex');
        if (arrow) arrow.style.transform = 'rotate(180deg)';
      } else {
        submenu.classList.add('hidden');
        submenu.classList.remove('flex');
        if (arrow) arrow.style.transform = 'rotate(0deg)';
      }
    }

    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('toggle-sidebar');
    const sidebarTexts = document.querySelectorAll('.sidebar-text');
    let isCollapsed = false;

    toggleBtn.addEventListener('click', () => {
      isCollapsed = !isCollapsed;
      if (isCollapsed) {
        sidebar.classList.remove('w-64');
        sidebar.classList.add('w-20');
        sidebarTexts.forEach(el => el.classList.add('hidden'));
        toggleBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
        document.querySelectorAll('[id$="-submenu"]').forEach(el => {
          el.classList.add('hidden');
          el.classList.remove('flex');
        });
      } else {
        sidebar.classList.add('w-64');
        sidebar.classList.remove('w-20');
        sidebarTexts.forEach(el => el.classList.remove('hidden'));
        toggleBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
      }
    });

    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    mobileMenuBtn.addEventListener('click', () => {
      sidebar.classList.toggle('-translate-x-full');
      sidebar.classList.toggle('absolute');
      sidebar.classList.toggle('z-50');
      sidebar.classList.toggle('h-full');
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // --- URL DE WEBHOOK (DEBES REEMPLAZARLA) ---
      const MAKE_WORKER_SAVE_URL = "https://hook.eu2.make.com/tbx80d01vf61z9lwty4mslubrgrapd8t";

      const form = document.getElementById("worker-form");

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        console.log("Enviando datos del trabajador:", data);

        fetch(MAKE_WORKER_SAVE_URL, {
          method: "POST",
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        })
          .then(response => {
            if (!response.ok) throw new Error("La respuesta del servidor no fue exitosa.");
            return response.text();
          })
          .then(result => {
            console.log("Respuesta de Make:", result);
            showSuccessModal();
          })
          .catch(err => {
            console.error("Error al registrar el trabajador:", err);
            alert("Hubo un error al registrar el trabajador.");
          });
      });

      // --- LÓGICA DE MODAL DE ÉXITO ---
      const successModal = document.getElementById('success-modal');
      const closeSuccessModalBtn = document.getElementById('close-success-modal');

      function showSuccessModal() {
        successModal.classList.add('show');
      }
      function closeSuccessModal() {
        successModal.classList.remove('show');
        form.reset();
      }
      closeSuccessModalBtn.addEventListener('click', closeSuccessModal);
    });
  </script>
</body>

</html>