<!DOCTYPE html>
<html lang="es" class="h-full">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
    content="Versa Finanzas: portal corporativo para operaciones financieras, tickets y reportes con experiencia premium." />
  <title>Versa Finanzas | Portal Corporativo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com" defer></script>
  <link rel="stylesheet" href="./theme.css" />
</head>

<body class="min-h-screen bg-[var(--bg)] text-[var(--text)] font-['Montserrat',sans-serif]">

  <a class="sr-only focus:not-sr-only focus:fixed focus:z-50 focus:top-4 focus:left-4 focus:px-4 focus:py-2 focus:rounded-lg focus:bg-white/90 focus:text-black"
    href="#contenido-principal">
    Ir al contenido principal
  </a>

  <div class="app-shell">
    <aside class="sidebar" aria-label="Men√∫ principal">
      <div class="sidebar__header">
        <div class="brand-lockup">
          <span class="brand-lockup__mark" aria-hidden="true">
            <img src="assets/logo.png" alt="Logo de Versa Finanzas" />
          </span>
          <div class="brand-lockup__copy">
            <span class="brand-lockup__title">Versa Finanzas</span>
            <span class="brand-lockup__subtitle">Portal corporativo</span>
          </div>
        </div>
        <p class="sidebar__quote">Navega con precisi√≥n cada flujo econ√≥mico y alinea a tu equipo con m√©tricas
          accionables.</p>
      </div>
      <nav id="mainNavigation">
        <span class="nav__title">Panel</span>
        <a class="navlink" data-requires="admin" href="#dashboard">
          <span aria-hidden="true">üìä</span>
          <span>Dashboard ejecutivo</span>
        </a>
        <a class="navlink" data-requires="admin" href="#admin">
          <span aria-hidden="true">üõ°Ô∏è</span>
          <span>Administraci√≥n de accesos</span>
        </a>
        <a class="navlink" href="#facturas">
          <span aria-hidden="true">üßæ</span>
          <span>Gesti√≥n de facturas</span>
        </a>
        <a class="navlink" href="manager-taller.html">
          <span aria-hidden="true">üõ†Ô∏è</span>
          <span>MANAGER TALLER</span>
        </a>
      </nav>
      <footer>¬© <span id="year"></span> Versa Labs. Inteligencia financiera en tiempo real.</footer>
    </aside>

    <section class="main" id="contenido-principal">
      <header class="topbar">
        <div class="topbar__brand">
          <button id="mobileMenuBtn" class="mobile-nav-toggle" type="button" aria-expanded="false"
            aria-controls="mobileNavPanel">
            <span aria-hidden="true">‚ò∞</span>
            <span class="sr-only">Abrir men√∫ principal</span>
          </button>
          <div class="brand-chip" aria-hidden="true">
            <span class="brand-chip__mark">V</span>
            <div class="brand-chip__copy">
              <span class="brand-chip__title">Panel Versa</span>
              <span class="brand-chip__subtitle">Seguimiento integral</span>
            </div>
          </div>
          <h1 class="sr-only">Versa Finanzas ¬∑ Portal corporativo</h1>
        </div>
        <div class="topbar__meta" aria-live="polite">
          <span id="userInfo" class="topbar__user"></span>
          <button id="btnLogout" class="btn btn-dark btn-sm">Salir</button>
        </div>
      </header>

      <main id="viewContainer" class="flex-1 space-y-6 p-6">
        <!-- Vista: Dashboard (solo administradores) -->
        <section id="dashboard" class="surface space-y-6" data-view="dashboard" data-requires="admin"
          aria-labelledby="dashboard-title">
          <div class="section-title">
            <div>
              <h2 id="dashboard-title" class="text-2xl font-semibold">Visi√≥n general</h2>
              <p class="section-title__description">Resumen ejecutivo de rendimiento, liquidez y foco operativo.</p>
            </div>
            <span class="badge badge--accent">Actualizado cada 15 min</span>
          </div>

          <div class="stat-grid">
            <article class="stat-card">
              <header class="stat-card__label">Ingresos (mes)</header>
              <div class="stat-card__value" data-dashboard="ingresos">‚Äî</div>
              <p class="stat-card__trend">Datos pendientes de carga</p>
            </article>
            <article class="stat-card">
              <header class="stat-card__label">Egresos (mes)</header>
              <div class="stat-card__value" data-dashboard="egresos">‚Äî</div>
              <p class="stat-card__trend">Datos pendientes de carga</p>
            </article>
            <article class="stat-card">
              <header class="stat-card__label">IVA estimado</header>
              <div class="stat-card__value" data-dashboard="iva">‚Äî</div>
              <p class="stat-card__trend">Datos pendientes de carga</p>
            </article>
            <article class="stat-card">
              <header class="stat-card__label">Facturas por aprobar</header>
              <div class="stat-card__value" data-dashboard="pendientes">‚Äî</div>
              <p class="stat-card__trend">Datos pendientes de carga</p>
            </article>
          </div>

          <div class="summary">
            <article class="summary-card">
              <div class="summary-card__header">
                <span>Alertas de auditor√≠a</span>
                <span class="status" data-variant="pending">Sin datos</span>
              </div>
              <p class="helper-text">Los datos reales se mostrar√°n cuando est√©n disponibles.</p>
              <button class="btn btn-ghost btn-sm" type="button" disabled>Revisar alertas</button>
            </article>
            <article class="summary-card">
              <div class="summary-card__header">
                <span>√öltimo lote procesado</span>
                <time aria-hidden="true">‚Äî</time>
              </div>
              <strong>‚Äî</strong>
              <p class="helper-text">Los registros aparecer√°n aqu√≠ una vez se procesen datos reales.</p>
            </article>
          </div>

          <div class="surface-2">
            <div class="section-title">
              <div>
                <h3 class="text-lg font-semibold">Actividad reciente</h3>
                <p class="section-title__description">Seguimiento de los env√≠os clave y su estado operativo.</p>
              </div>
            </div>
            <div class="timeline">
              <article class="timeline__item">
                <header class="timeline__meta">Actividad en espera</header>
                <p>No hay eventos recientes. Cuando se registren movimientos reales, aparecer√°n en esta secci√≥n.</p>
                <span class="status" data-variant="pending">Sin actividad</span>
              </article>
            </div>
          </div>

          <article class="surface space-y-4" aria-labelledby="looker-dashboard-title">
            <header class="section-title">
              <div>
                <h3 id="looker-dashboard-title" class="text-lg font-semibold">Dashboard interactivo</h3>
                <p class="section-title__description">Explora m√©tricas en vivo de Looker Studio con filtros avanzados.
                </p>
              </div>
              <span class="badge badge--accent">Looker Studio</span>
            </header>
            <div class="dashboard-wrapper">
              <div class="dashboard-hint">
                <div class="dashboard-hint__copy">
                  <strong>Recomendaci√≥n UX</strong>
                  <span>Activa el modo pantalla completa para presentar indicadores en salas de comit√© o revisarlos en
                    detalle.</span>
                </div>
                <button type="button" id="dashboardFullscreenBtn" class="btn btn-wire btn-sm"
                  aria-controls="lookerFrame">
                  ‚§¢ Pantalla completa
                </button>
              </div>
              <iframe id="lookerFrame" class="dashboard-frame"
                src="https://lookerstudio.google.com/embed/reporting/89f974df-1e6d-44c9-ac58-948494fa5b27/page/rfReF"
                frameborder="0" allowfullscreen
                sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox"
                aria-label="Dashboard de Looker Studio"></iframe>
            </div>
          </article>
        </section>

        <!-- Vista: Administraci√≥n (solo administradores) -->
        <section id="admin" class="space-y-6" data-view="admin" data-requires="admin" aria-labelledby="admin-title"
          hidden>
          <article class="surface space-y-6">
            <div class="section-title">
              <div>
                <h2 id="admin-title" class="text-2xl font-semibold">Administraci√≥n de accesos</h2>
                <p class="section-title__description">Crea cuentas seguras y controla los permisos del personal.</p>
              </div>
              <span class="badge badge--accent">Solo administradores</span>
            </div>

            <div class="admin-grid">
              <form id="createUserForm" class="form-grid admin-form" autocomplete="off">
                <label class="field">
                  <span>Email corporativo <span class="text-red-500">*</span></span>
                  <input type="email" name="email" class="input w-full" placeholder="persona@versa.com"
                    autocomplete="off" required />
                </label>
                <label class="field">
                  <span>Nombre completo</span>
                  <input type="text" name="name" class="input w-full" placeholder="Opcional" autocomplete="off" />
                </label>
                <label class="field">
                  <span>Rol</span>
                  <select name="role" class="input w-full">
                    <option value="empleado">Empleado</option>
                    <option value="admin">Administrador</option>
                  </select>
                </label>
                <label class="field field--full">
                  <span>Contrase√±a temporal <span class="text-red-500">*</span></span>
                  <div class="password-field">
                    <input type="text" name="password" id="newUserPassword" class="input w-full" required minlength="10"
                      autocomplete="off" />
                    <button type="button" id="btnGeneratePassword" class="btn btn-dark btn-sm">Generar</button>
                  </div>
                  <p class="helper-text">Comparte la clave por un canal seguro. La ver√°s solo una vez.</p>
                </label>
                <div class="form-actions field--full">
                  <button type="submit" class="btn btn-brand">Crear usuario</button>
                </div>
              </form>

              <div class="surface-2 admin-hint">
                <h3 class="text-lg font-semibold">Buenas pr√°cticas de seguridad</h3>
                <ul class="admin-hint__list">
                  <li>Utiliza contrase√±as √∫nicas de al menos 10 caracteres.</li>
                  <li>Revoca el acceso cuando un integrante deja la organizaci√≥n.</li>
                  <li>Comparte las credenciales iniciales usando canales cifrados.</li>
                  <li>Garantiza que haya m√°s de un administrador activo como respaldo.</li>
                </ul>
                <p id="adminFeedback" class="form-feedback" role="status" aria-live="polite" hidden></p>
                <div id="adminGeneratedSecret" class="generated-secret" hidden>
                  <p class="generated-secret__label">Contrase√±a generada</p>
                  <code class="generated-secret__value" aria-live="polite"></code>
                  <p class="helper-text">Copia y entrega esta clave inmediatamente; no volver√° a mostrarse.</p>
                </div>
              </div>
            </div>
          </article>

          <article class="surface-2 space-y-4">
            <div class="section-title">
              <div>
                <h3 class="text-lg font-semibold">Usuarios registrados</h3>
                <p class="section-title__description">Actualiza roles, restablece contrase√±as o revoca accesos.</p>
              </div>
            </div>
            <div id="userList" class="user-admin-list" role="region" aria-live="polite" aria-busy="false"></div>
          </article>

          <!-- ============================= -->
          <!-- NUEVO PANEL SUPER ADMIN (SaaS) -->
          <!-- ============================= -->
          <article id="superAdminPanel" class="surface space-y-6" hidden>
            <div class="section-title">
              <div>
                <h3 class="text-lg font-semibold">Panel Super Admin (nuevo SaaS)</h3>
                <p class="section-title__description">Herramientas preparadas para la administraci√≥n multi-tenant.</p>
              </div>
              <span class="badge badge--accent">Solo super admins</span>
            </div>

            <div class="surface-2 space-y-4">
              <div class="section-title">
                <div>
                  <h4 class="text-base font-semibold">Gesti√≥n de Tenants</h4>
                  <p class="section-title__description">Configura nuevos entornos SaaS para cada cliente.</p>
                </div>
                <div class="flex items-center gap-2">
                  <button type="button" id="toggleTenantFormBtn" class="btn btn-wire btn-sm">Nuevo tenant</button>
                </div>
              </div>
              <div id="tenantList" class="user-admin-list" aria-live="polite">
                <p class="helper-text">Todav√≠a sin datos.</p>
              </div>
              <div id="tenantFormWrapper" class="surface" hidden>
                <form id="tenantForm" class="form-grid admin-form" autocomplete="off">
                  <label class="field field--full">
                    <span>Nombre del tenant <span class="text-red-500">*</span></span>
                    <input type="text" name="nombre" class="input w-full" placeholder="Cliente corporativo" required />
                  </label>
                  <div class="form-actions field--full">
                    <button type="submit" class="btn btn-brand">Crear tenant</button>
                    <button type="button" id="cancelTenantFormBtn" class="btn btn-ghost">Cancelar</button>
                  </div>
                  <p id="tenantFeedback" class="form-feedback" role="status" aria-live="polite" hidden></p>
                </form>
              </div>
            </div>

            <div class="surface-2 space-y-4">
              <div class="section-title">
                <div>
                  <h4 class="text-base font-semibold">Crear Usuario SaaS</h4>
                  <p class="section-title__description">Usuarios conectados al modelo multi-tenant.</p>
                </div>
              </div>
              <form id="createSaaSUserForm" class="form-grid admin-form" autocomplete="off">
                <label class="field">
                  <span>Nombre completo</span>
                  <input type="text" name="nombre" class="input w-full" placeholder="Persona responsable" />
                </label>
                <label class="field">
                  <span>Email corporativo</span>
                  <input type="email" name="email" class="input w-full" placeholder="persona@cliente.com" />
                </label>
                <label class="field">
                  <span>Contrase√±a inicial</span>
                  <input type="password" name="password" class="input w-full" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                </label>
                <label class="field">
                  <span>Porcentaje mano de obra</span>
                  <input type="number" name="porcentaje_mano_obra" class="input w-full" step="0.01" min="0" max="1"
                    value="0.50" />
                  <p class="helper-text">Valor por defecto: 0.50 (50 %).</p>
                </label>
                <label class="field">
                  <span>Es super admin</span>
                  <div class="inline-flex items-center gap-2">
                    <input type="checkbox" name="is_super_admin" class="accent-[var(--accent)]" />
                    <span class="helper-text">Otorga permisos globales en el SaaS.</span>
                  </div>
                </label>
                <label class="field">
                  <span>Roles (multi-selecci√≥n)</span>
                  <select id="rolesSelect" name="roles" class="input w-full" multiple size="4">
                    <option disabled>TODO: cargar roles desde /roles</option>
                  </select>
                  <p class="helper-text">Selecciona uno o varios roles cuando est√©n disponibles.</p>
                </label>
                <label class="field">
                  <span>Sucursales (multi-selecci√≥n)</span>
                  <select id="sucursalesSelect" name="sucursales" class="input w-full" multiple size="4">
                    <option disabled>TODO: cargar sucursales desde /sucursales</option>
                  </select>
                  <p class="helper-text">Asigna el usuario a las sucursales correspondientes.</p>
                </label>
                <div class="form-actions field--full">
                  <button type="submit" class="btn btn-brand">Crear usuario SaaS</button>
                </div>
                <p id="saasUserFeedback" class="form-feedback" role="status" aria-live="polite" hidden></p>
              </form>
            </div>
          </article>
        </section>

        <!-- Vista: Gesti√≥n de facturas -->
        <section id="facturas" class="space-y-6" data-view="facturas" aria-labelledby="facturas-title">
          <article class="surface invoice-pane">
            <header class="invoice-pane__header">
              <div>
                <p class="eyebrow">Carga de facturas</p>
                <h2 id="facturas-title">Centraliza tus comprobantes</h2>
                <p class="invoice-pane__lead">Arrastra tus archivos o captura desde el m√≥vil. Soporte para PDF e
                  im√°genes de hasta 20 MB.</p>
              </div>
              <button id="clearAll" type="button" class="btn btn-ghost btn-sm">Vaciar selecci√≥n</button>
            </header>

            <input id="cameraInput" class="sr-only" type="file" accept="image/*" capture="environment" multiple />
            <input id="fileInput" class="sr-only" type="file" accept="image/*,application/pdf" multiple />
            <input id="csvInput" class="sr-only" type="file" accept="text/csv,.csv" />

            <div class="intake-mode" role="group" aria-labelledby="intake-question">
              <div>
                <p id="intake-question" class="intake-mode__question">¬øLa captura incluye la factura?</p>
                <span class="helper-text">Elige si subir√°s los archivos o si registrar√°s los datos manualmente.</span>
              </div>
              <div class="segmented-control" role="tablist" aria-label="Modo de carga">
                <button type="button" class="segmented-control__item is-active" role="tab" aria-selected="true"
                  data-intake-mode="files">
                  S√≠, adjuntar archivo
                </button>
                <button type="button" class="segmented-control__item" role="tab" aria-selected="false"
                  data-intake-mode="manual">
                  No, introducir datos
                </button>
              </div>
            </div>

            <div class="upload-stack" data-intake-section="files">
              <div class="upload-stack__header">
                <div>
                  <h3>Adjuntar factura</h3>
                  <p class="helper-text">Compatible con PDF, JPG, PNG y HEIC. Puedes a√±adir varios archivos a la vez.
                  </p>
                </div>
                <div class="upload-actions">
                  <label class="btn btn-light" for="cameraInput" role="button" tabindex="0">üì∑ Tomar foto</label>
                  <label class="btn btn-dark" for="fileInput" role="button" tabindex="0">‚§¥Ô∏è Subir archivos</label>
                  <label class="btn btn-wire" for="csvInput" role="button" tabindex="0">üßæ Importar CSV</label>
                </div>
              </div>
              <div id="dropzone" class="dropzone dropzone--quiet" role="region" aria-live="polite">
                <div class="dropzone__icon" aria-hidden="true">‚òÅÔ∏è</div>
                <strong>Arrastra el archivo aqu√≠</strong>
                <p class="helper-text">Tambi√©n puedes pulsar en ‚ÄúTomar foto‚Äù o ‚ÄúSubir archivos‚Äù.</p>
              </div>
            </div>

            <section class="csv-import" data-intake-section="files" aria-labelledby="csvImportTitle">
              <div class="csv-import__header">
                <div>
                  <h3 id="csvImportTitle">Importar metadatos v√≠a CSV</h3>
                  <p class="helper-text">
                    Carga un archivo con columnas como descripci√≥n, √°rea, naturaleza, m√©todo de pago, categor√≠a, fecha,
                    subtotal,
                    IVA, total y notas.
                  </p>
                </div>
                <div class="csv-import__actions">
                  <button id="csvClear" type="button" class="btn btn-ghost btn-sm" hidden>Eliminar CSV</button>
                </div>
              </div>
              <p id="csvStatus" class="helper-text" role="status" aria-live="polite">No hay CSV importado todav√≠a.</p>
              <div id="csvAlerts" class="csv-import__alerts" aria-live="polite"></div>
              <div id="csvPreview" class="csv-preview" hidden></div>
            </section>

            <div class="file-list" aria-live="polite" data-intake-section="files">
              <p class="helper-text" id="fileListEmpty">No hay archivos a√±adidos todav√≠a.</p>
              <div id="fileList" class="file-grid"></div>
            </div>
          </article>

          <article id="manualEntry" class="surface invoice-meta" aria-labelledby="metadata-title" hidden>
            <header class="invoice-meta__header">
              <div>
                <p class="eyebrow">Metadatos del env√≠o</p>
                <h3 id="metadata-title">Aplica la misma informaci√≥n al lote</h3>
              </div>
              <span class="badge badge--subtle">Opcional salvo descripci√≥n</span>
            </header>
            <form id="metaForm" class="form-grid" autocomplete="off">
              <label class="field">
                <span>Descripci√≥n del lote <span class="text-red-500">*</span></span>
                <textarea name="descripcion" rows="3" class="input w-full mt-1"
                  placeholder="Ej. Facturas de mantenimiento preventivo de la flota" required></textarea>
              </label>
              <label class="field">
                <span>√Årea</span>
                <select name="area" class="input w-full" required>
                  <option value="" selected disabled>Selecciona √°rea</option>
                  <option value="Flota">Flota</option>
                  <option value="Taller">Taller</option>
                  <option value="Bicicletas">Bicicletas</option>
                </select>
              </label>
              <fieldset class="field" style="grid-column: 1 / -1">
                <span>Naturaleza</span>
                <div class="radio-group">
                  <label>
                    <input class="accent-[var(--accent)]" type="radio" name="naturaleza" value="Ingreso" />
                    Ingreso
                  </label>
                  <label>
                    <input class="accent-[var(--accent)]" type="radio" name="naturaleza" value="Egreso" checked />
                    Egreso
                  </label>
                </div>
              </fieldset>
              <label class="field" style="grid-column: 1 / -1">
                <span>Notas</span>
                <textarea name="notas" rows="3" class="input w-full"
                  placeholder="Observaciones, centros de coste, referencias internas..."></textarea>
              </label>
            </form>
          </article>

          <article class="surface invoice-submit" aria-labelledby="submit-title">
            <div class="invoice-submit__header">
              <div>
                <p class="eyebrow">Revisi√≥n final</p>
                <h3 id="submit-title">Env√≠a el lote cuando est√© listo</h3>
              </div>
              <label class="inline-flex items-center gap-2 text-sm text-[var(--muted)]">
                <input id="chkBorrado" type="checkbox" class="accent-[var(--accent)]" />
                Borrar archivos locales tras enviar
              </label>
            </div>
            <div class="invoice-submit__actions">
              <button type="button" class="btn btn-ghost">Guardar borrador</button>
              <button id="btnEnviar" type="button" class="btn btn-brand">Enviar ahora</button>
            </div>
            <p id="status" class="helper-text" role="status" aria-live="polite">A√±ade tus archivos para comenzar.</p>
          </article>
        </section>
      </main>
    </section>
  </div>

  <div id="mobileNavOverlay" class="mobile-nav-overlay" aria-hidden="true">
    <div id="mobileNavPanel" class="mobile-nav" role="dialog" aria-modal="true" aria-labelledby="mobileNavTitle"
      tabindex="-1">
      <header class="mobile-nav__header">
        <div class="mobile-nav__brand">
          <p class="mobile-nav__eyebrow">Versa Finanzas</p>
          <h2 id="mobileNavTitle">Men√∫ principal</h2>
          <p id="mobileUserInfo" class="mobile-nav__user"></p>
        </div>
        <button id="mobileNavClose" class="mobile-nav__close" type="button" aria-label="Cerrar men√∫">
          ‚úï
        </button>
      </header>
      <nav class="mobile-nav__body" aria-label="Navegaci√≥n m√≥vil">
        <a class="navlink" data-requires="admin" href="#dashboard">
          <span aria-hidden="true">üìä</span>
          <span>Dashboard ejecutivo</span>
        </a>
        <a class="navlink" data-requires="admin" href="#admin">
          <span aria-hidden="true">üõ°Ô∏è</span>
          <span>Administraci√≥n de accesos</span>
        </a>
        <a class="navlink" href="#facturas">
          <span aria-hidden="true">üßæ</span>
          <span>Gesti√≥n de facturas</span>
        </a>
        <a class="navlink" href="manager-taller.html">
          <span aria-hidden="true">üõ†Ô∏è</span>
          <span>MANAGER TALLER</span>
        </a>
      </nav>
      <div class="mobile-nav__footer">
        <p class="mobile-nav__hint">Usa el men√∫ para navegar entre vistas y gestionar tus env√≠os.</p>
      </div>
    </div>
  </div>

  <button type="button" id="dashboardFullscreenClose" class="dashboard-fullscreen-close" aria-hidden="true">
    ‚úï Salir de pantalla completa
  </button>

  <noscript>
    <div class="fixed inset-0 z-50 grid place-items-center bg-black/80 p-6 text-center text-white">
      <div class="max-w-sm space-y-3 rounded-2xl bg-[#111]/90 p-6">
        <h2 class="text-xl font-semibold">JavaScript requerido</h2>
        <p class="text-sm text-gray-200">
          Para utilizar el portal financiero de Versa Finanzas necesitas activar JavaScript en tu navegador.
        </p>
      </div>
    </div>
  </noscript>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
  <script src="./config.js"></script>
  <script src="./auth.js" defer></script>
  <script src="./admin.js" defer></script>
  <script src="./main.js" defer></script>
</body>

</html>